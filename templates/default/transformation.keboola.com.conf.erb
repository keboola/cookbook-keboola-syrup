<VirtualHost *:80>
	ServerName <%= @params[:server_name] %>
    ServerAlias <% @params[:server_aliases].each do |a| %><%= a %> <% end %>

    DocumentRoot /www/transformation/latest/public

    ErrorLog "|/usr/bin/logger -t 'apache_tapi_a02_err' -p local1.info"
    CustomLog "|/usr/bin/logger -t 'apache_tapi_a02' -p local1.info" combined

    SetEnv APPLICATION_ENV development

    <Directory /www/transformation/latest/public>
        AllowOverride All
        Require all granted
    </Directory>

    php_admin_value upload_tmp_dir /tmp/syrup
    php_value include_path .:/www/transformation/:/www/transformation/latest/:/usr/share/php
    php_admin_value error_log syslog
    php_admin_value short_open_tag on
    php_flag display_startup_errors off
    php_flag log_errors on
    php_flag display_errors off
    php_value post_max_size 2048M
    php_value upload_max_filesize  2048M

#AWS ELB http > https on client side
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteCond %{HTTP:X-Forwarded-Proto} !https
        RewriteRule !/status\.php https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301]
    </IfModule>

</VirtualHost>

<VirtualHost *:443>

    ServerName <%= @params[:server_name] %>
    ServerAlias <% @params[:server_aliases].each do |a| %><%= a %> <% end %>

    DocumentRoot /www/transformation/latest/public

    ErrorLog "|/usr/bin/logger -t 'apache_ssl_tapi_a02_err' -p local1.info"
    CustomLog "|/usr/bin/logger -t 'apache_ssl_tapi_a02' -p local1.info" combined

    SetEnv APPLICATION_ENV development

    <Directory /www/transformation/latest/public>
        AllowOverride All
        Require all granted
    </Directory>

    php_admin_value upload_tmp_dir /tmp/syrup
    php_value include_path .:/www/transformation/:/www/transformation/latest/:/usr/share/php
    php_admin_value error_log syslog
    php_admin_value short_open_tag on
    php_flag display_startup_errors off
    php_flag log_errors on
    php_flag display_errors off
    php_value post_max_size 2048M
    php_value upload_max_filesize  2048M

   SSLEngine on
SSLProtocol all -SSLv3 -SSLv2
SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK
SSLCertificateFile /etc/httpd/ssl/x.keboola.com.crt
SSLCertificateKeyFile /etc/httpd/ssl/x.keboola.com.key
SSLCACertificateFile /etc/httpd/ssl/rapidssl.intermediate.ca
SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown downgrade-1.0 force-response-1.0

</VirtualHost>
