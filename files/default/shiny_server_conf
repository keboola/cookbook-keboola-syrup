# applications are run as this user
run_as shiny;

auth_passwd_file /etc/shiny-server/passwd;

server {

	# listen on 443 for https connections
	listen 3838;
	
	# tell the server where the ssl cert is
	# ssl /etc/shiny-server/ssl-key.pem /etc/shiny-server/ssl.cert;
	
	# allow the following request headers
	whitelist_headers X_StorageApi_Token;
	# will be available in server as session$request$HTTP_X_STORAGEAPI_TOKEN
	
	# Define the location available at the base URL
	location / {
    	#### PRO ONLY ####
	    # Only up tp 20 connections per Shiny process and at most 3 Shiny processes
	    # per application. Proactively spawn a new process when our processes reach 
    	# 90% capacity.
    	utilization_scheduler 20 .9 3;
    	#### END PRO ONLY ####

    	# Run this location in 'site_dir' mode, which hosts the entire directory
    	# tree at '/srv/shiny-server'
    	site_dir /srv/shiny-server;
    
    	# Define where we should put the log files for this location
    	log_dir /var/log/shiny-server;
    
  	}
}

admin 4151 {
	
	# ssl cert for the administration site
	# ssl /etc/shiny-server/ssl-key.pem /etc/shiny-server/ssl.cert;
	
	# only user by name shiny-admin can access the admin page
	required_user shiny-admin;  
}
	